const fs = require('fs');
const path = require('path');

// Ensure the icons directory exists
const iconsDir = path.join(__dirname, 'assets', 'icons');
if (!fs.existsSync(iconsDir)) {
  fs.mkdirSync(iconsDir, { recursive: true });
}

// For macOS, template images work best for menu bar icons
// A template image is one that macOS can adapt for light/dark mode
// These should be black and white (with transparency)
// macOS will invert them as needed for light/dark mode

// This is a very basic 16x16 black square PNG file with a simple pattern
// It's a modified version of the minimal PNG with black fill
const macOSTemplateIcon = Buffer.from([
  // PNG signature
  0x89, 0x50, 0x4E, 0x47, 0x0D, 0x0A, 0x1A, 0x0A,
  
  // IHDR chunk
  0x00, 0x00, 0x00, 0x0D, 0x49, 0x48, 0x44, 0x52,
  0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x10,
  0x08, 0x06, 0x00, 0x00, 0x00, 0x1F, 0xF3, 0xFF,
  0x61,
  
  // bKGD chunk (black background)
  0x00, 0x00, 0x00, 0x06, 0x62, 0x4B, 0x47, 0x44,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF9, 0x43,
  0xBB, 0x7F,
  
  // IDAT chunk (image data - a black square)
  0x00, 0x00, 0x00, 0x23, 0x49, 0x44, 0x41, 0x54,
  0x28, 0x91, 0x63, 0x60, 0x00, 0x02, 0xFF, 0xFF,
  0xFF, 0x8F, 0x06, 0xD8, 0xC1, 0xFF, 0xFF, 0xFF,
  0x13, 0x01, 0xD9, 0x89, 0xFF, 0x00, 0x0D, 0x01,
  0x00, 0x00, 0x00, 0xFF, 0xFF, 0x00, 0x0A, 0x00,
  0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0xFB, 0xD7, 0xA4, 0x0F,
  
  // IEND chunk
  0x00, 0x00, 0x00, 0x00, 0x49, 0x45, 0x4E, 0x44,
  0xAE, 0x42, 0x60, 0x82
]);

// Create an easier-to-see icon for debugging
const visibleRedIcon = Buffer.from([
  // PNG signature
  0x89, 0x50, 0x4E, 0x47, 0x0D, 0x0A, 0x1A, 0x0A,
  
  // IHDR chunk
  0x00, 0x00, 0x00, 0x0D, 0x49, 0x48, 0x44, 0x52,
  0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0x20,
  0x08, 0x02, 0x00, 0x00, 0x00, 0xFC, 0x18, 0xED,
  0xA3,
  
  // IDAT chunk (image data - a red square)
  0x00, 0x00, 0x00, 0x0C, 0x49, 0x44, 0x41, 0x54,
  0x78, 0x9C, 0x63, 0x60, 0x18, 0x05, 0xA3, 0x60,
  0x14, 0x8C, 0x94, 0x00, 0x00, 0x02, 0x61, 0x00,
  0x01, 0x21, 0x15, 0x36, 0xA6,
  
  // IEND chunk
  0x00, 0x00, 0x00, 0x00, 0x49, 0x45, 0x4E, 0x44,
  0xAE, 0x42, 0x60, 0x82
]);

try {
  // Write the files
  fs.writeFileSync(path.join(iconsDir, 'tray-icon.png'), visibleRedIcon);
  fs.writeFileSync(path.join(iconsDir, 'tray-icon-template.png'), macOSTemplateIcon);
  fs.writeFileSync(path.join(iconsDir, 'icon.png'), visibleRedIcon);
  fs.writeFileSync(path.join(iconsDir, 'logo.png'), visibleRedIcon);
  
  console.log('Created macOS-friendly icons in:', iconsDir);
  console.log('The tray icon is now a visible red square for debugging purposes.');
  console.log('Also created a template icon for macOS (black and white).');
} catch (error) {
  console.error('Error creating icons:', error);
} 